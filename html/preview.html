<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Preview - Testimonial Wall + Add Feedback</title>
  <style>
    :root{
      --accent: #4facfe;
      --accent-2: #00f2fe;
      --bg: #f5f8fb;
      --card-bg: rgba(255,255,255,0.98);
      --muted: #6b7280;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: var(--bg);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      line-height:1.45;
    }

    /* NAV (kept intact) */
    header{background:#111827}
    .navbar{max-width:1200px;margin:0 auto;padding:12px 20px}
    .navbar ul{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
    .navbar a{color:#fff;text-decoration:none;padding:6px 10px;border-radius:8px;display:inline-block;font-weight:600}
    .navbar a:hover{background:rgba(255,255,255,0.04);color:var(--accent)}

    main{max-width:1200px;margin:28px auto;padding:20px}

    /* Hero */
    .hero{text-align:center;margin-bottom:12px}
    .hero h1{margin:6px 0;font-size:clamp(1.6rem,2.6vw,2.2rem)}
    .hero p{color:var(--muted);margin:0 0 8px}

    /* Filters */
    .filters{display:flex;gap:10px;justify-content:center;margin:16px 0 26px;flex-wrap:wrap}
    .filter-btn{
      padding:8px 14px;border-radius:999px;border:1px solid rgba(17,24,39,0.06);
      background:linear-gradient(90deg, rgba(255,255,255,0.6), rgba(255,255,255,0.5));
      cursor:pointer;font-weight:600;color:#111827;box-shadow:0 4px 12px rgba(13,27,50,0.04);
      transition:all .22s ease;
    }
    .filter-btn.active{
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;transform:translateY(-2px);box-shadow:0 8px 30px rgba(79,172,254,0.18);
    }

    /* Testimonial Wall */
    .testimonial-wall{padding:18px;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:12px;box-shadow:0 6px 30px rgba(15,23,42,0.04)}
    .masonry{column-count:3;column-gap:18px}
    @media (max-width:1000px){.masonry{column-count:2}}
    @media (max-width:640px){.masonry{column-count:1}}

    .card{
      display:inline-block;width:100%;margin:0 0 18px;background:var(--card-bg);border-radius:12px;padding:14px;
      box-shadow:0 6px 18px rgba(12,18,30,0.06);transform-origin:center;transition:transform .25s,box-shadow .25s;
      position:relative;overflow:hidden;opacity:0;animation:pop .45s ease forwards;
    }
    .card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 18px 40px rgba(12,18,30,0.12)}
    .meta{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .avatar{width:48px;height:48px;border-radius:50%;flex:0 0 48px;object-fit:cover;border:2px solid rgba(0,0,0,0.04)}
    .who{font-weight:700}
    .cat{margin-left:auto;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#eef6ff,#f0fbff);color:var(--muted);font-weight:600;font-size:.85rem}
    .card p{margin:6px 0 10px;color:#111827}
    .footer{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .badge{font-size:.85rem;color:var(--muted);font-weight:600}
    .card.video::after{content:"▶";position:absolute;right:12px;bottom:12px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;padding:10px;border-radius:999px;font-weight:700;box-shadow:0 8px 20px rgba(0,0,0,0.12);}

    .card::before{content:"";position:absolute;left:0;top:0;height:100%;width:6px;border-radius:12px 0 0 12px;background:linear-gradient(180deg, rgba(74,192,254,0.8), rgba(0,242,254,0.6));opacity:.08;transition:opacity .25s}
    .card:hover::before{opacity:.18}

    @keyframes pop{from{opacity:0;transform:translateY(14px) scale(.995)}to{opacity:1;transform:translateY(0) scale(1)}}

    /* Modal for video */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(6,8,15,0.6), rgba(6,8,15,0.85));z-index:1200;padding:20px}
    .modal.open{display:flex}
    .modal .inner{width:100%;max-width:980px;background:#0f1724;border-radius:12px;padding:12px;box-shadow:0 30px 90px rgba(2,6,23,0.6)}
    .modal iframe{width:100%;height:540px;border:0;border-radius:8px}
    .modal .close{margin-top:10px;display:flex;justify-content:flex-end}
    .close button{padding:8px 12px;border-radius:10px;background:#fff;border:0;cursor:pointer;font-weight:700}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .no-results{text-align:center;padding:36px;color:var(--muted)}

    /* Pages table */
    .pages{margin:22px 0;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);padding:14px;box-shadow:0 8px 30px rgba(12,18,30,0.04)}
    .pages table{width:100%;border-collapse:collapse}
    .pages th,.pages td{padding:12px 14px;text-align:left;border-bottom:1px solid rgba(15,23,42,0.04)}
    .pages thead th{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border-bottom:none}
    .pages tbody tr:hover{background:linear-gradient(90deg, rgba(74,172,254,0.04), rgba(0,242,254,0.02))}

    /* Add Feedback form */
    .add-feedback{margin-top:20px;background:linear-gradient(180deg,#fff,#fbfdff);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(12,18,30,0.04)}
    .add-feedback h2{margin-top:0}
    .form-row{display:flex;gap:12px;margin-bottom:10px;flex-wrap:wrap}
    .form-row .col{flex:1;min-width:180px}
    input[type="text"], select, textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #d1d5db;font-size:14px}
    textarea{min-height:90px;resize:vertical}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .controls button{padding:8px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;cursor:pointer;font-weight:700}
    .controls button.secondary{background:#e5e7eb;color:#111}
    .audio-playback{margin-top:6px}
    .submit-row{display:flex;justify-content:flex-end;margin-top:8px}
    .submit-row button{padding:10px 14px;border-radius:8px;border:0;background:#111827;color:white;cursor:pointer;font-weight:700}

    @media (max-width:640px){
      .filters{gap:8px}
      .modal iframe{height:360px}
      .form-row{flex-direction:column}
    }

  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <ul>
        <li><a href="about.html">About Us</a></li>
        <li><a href="features.html">Features</a></li>
        <li><a href="preview.html">Preview</a></li>
        <li><a href="techstack.html">Tech Stack</a></li>
        <li><a href="installation.html">Installation</a></li>
        <li><a href="folderstructure.html">Folder Structure</a></li>
        <li><a href="requirements.html">Requirement Document</a></li>
        <li><a href="contributing.html">Contributing</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h1>Our Success Stories — Testimonial Wall</h1>
      <p>Filter by category. Submit text or record voice feedback below — new testimonials appear instantly.</p>
    </section>

    <!-- Filters -->
    <div class="filters" role="tablist" aria-label="Testimonial filters">
      <button class="filter-btn active" data-filter="all" aria-pressed="true">All</button>
      <button class="filter-btn" data-filter="SOP">SOP</button>
      <button class="filter-btn" data-filter="LOR">LOR</button>
      <button class="filter-btn" data-filter="Editing">Editing</button>
    </div>

    <!-- Testimonial Wall -->
    <section class="testimonial-wall" aria-labelledby="wall-heading">
      <div id="wall-heading" class="sr-only">Testimonial wall</div>
      <div id="masonry" class="masonry" aria-live="polite">
        <!-- Existing sample cards -->
        <article class="card" data-category="SOP">
          <div class="meta">
            <img class="avatar" src="https://i.pravatar.cc/80?img=12" alt="Alex avatar">
            <div>
              <div class="who">Alex Johnson</div>
              <div class="badge">SOP • Student</div>
            </div>
            <div class="cat">SOP</div>
          </div>
          <p>"The SOP guidance was absolutely top-notch! Clear, concise, and personalized."</p>
          <div class="footer"><div class="badge">★★★★★</div><div class="muted">June 2025</div></div>
        </article>

        <article class="card" data-category="LOR">
          <div class="meta">
            <img class="avatar" src="https://i.pravatar.cc/80?img=24" alt="Priya avatar">
            <div>
              <div class="who">Priya Sharma</div>
              <div class="badge">LOR • Applicant</div>
            </div>
            <div class="cat">LOR</div>
          </div>
          <p>"They helped me get a powerful Letter of Recommendation that impressed my university."</p>
          <div class="footer"><div class="badge">★★★★☆</div><div class="muted">May 2025</div></div>
        </article>

        <article class="card video" data-category="SOP" data-video="https://www.youtube.com/embed/dQw4w9WgXcQ">
          <div class="meta">
            <img class="avatar" src="https://i.pravatar.cc/80?img=8" alt="Daniel avatar">
            <div>
              <div class="who">Daniel Lee</div>
              <div class="badge">SOP • Graduate</div>
            </div>
            <div class="cat">SOP</div>
          </div>
          <p>🎥 Alex shares his experience — click to watch his short video testimonial.</p>
          <div class="footer"><div class="badge">Video</div><div class="muted">April 2025</div></div>
        </article>

        <article class="card" data-category="Editing">
          <div class="meta">
            <img class="avatar" src="https://i.pravatar.cc/80?img=32" alt="Sara avatar">
            <div>
              <div class="who">Sara Khan</div>
              <div class="badge">Editing • Applicant</div>
            </div>
            <div class="cat">Editing</div>
          </div>
          <p>"Their editing service made my application shine like never before!"</p>
          <div class="footer"><div class="badge">★★★★★</div><div class="muted">March 2025</div></div>
        </article>
      </div>

      <div id="noResults" class="no-results" style="display:none">No testimonials match this filter.</div>
    </section>

    <!-- Pages Table -->
    <section class="pages" aria-label="Website pages overview">
      <h2 style="margin-top:0">Website Pages Overview</h2>
      <table>
        <thead>
          <tr><th>Page Name</th><th>Description</th></tr>
        </thead>
        <tbody>
          <tr><td>🏠 Landing Page</td><td>Introduces the brand, key offerings, and CTA links</td></tr>
          <tr><td>🧍 About Us</td><td>Shares the story, mission, and team bios</td></tr>
          <tr><td>📑 Services</td><td>Describes SOP, LOR, and editing services in detail</td></tr>
          <tr><td>💬 Testimonials</td><td>Feedback from clients</td></tr>
          <tr><td>❓ FAQs</td><td>Common questions answered</td></tr>
          <tr><td>📚 Resources</td><td>Sample docs and tips</td></tr>
          <tr><td>📝 Blog</td><td>Articles on writing and admissions</td></tr>
          <tr><td>📅 Booking Page</td><td>Schedule demos/consultations</td></tr>
          <tr><td>📩 Contact Page</td><td>Submit queries or emails</td></tr>
          <tr><td>🔐 Privacy & Terms</td><td>Legal sections</td></tr>
        </tbody>
      </table>
    </section>

    <!-- Add Feedback -->
    <section class="add-feedback" aria-labelledby="add-feedback-heading">
      <h2 id="add-feedback-heading">Share Your Feedback</h2>

      <form id="feedbackForm">
        <div class="form-row">
          <div class="col">
            <label for="name">Your Name</label>
            <input id="name" name="name" type="text" placeholder="Enter your name" required>
          </div>
          <div class="col">
            <label for="category">Category</label>
            <select id="category" name="category" required>
              <option value="">Select category</option>
              <option value="SOP">SOP</option>
              <option value="LOR">LOR</option>
              <option value="Editing">Editing</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:12px">
          <label for="textFeedback">Your Feedback (text)</label>
          <textarea id="textFeedback" name="textFeedback" placeholder="Write your feedback here" required></textarea>
        </div>

        <div>
          <label>Record Voice Feedback (optional)</label>
          <div class="controls">
            <button type="button" id="startRecord">🎤 Start Recording</button>
            <button type="button" id="stopRecord" disabled class="secondary">⏹ Stop</button>
            <button type="button" id="clearAudio" class="secondary" title="Clear recorded audio">✖ Clear</button>
          </div>
          <div class="audio-playback">
            <audio id="audioPlayback" controls style="display:none"></audio>
          </div>
        </div>

        <div class="submit-row">
          <button type="submit">Submit Feedback</button>
        </div>
      </form>

      <p style="margin-top:10px;color:var(--muted);font-size:13px">
        Tip: after submitting, your feedback will appear instantly on the testimonial wall. Audio is kept in-browser via an object URL (no server).
      </p>
    </section>

  </main>

  <!-- Video modal -->
  <div id="videoModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="inner" role="document">
      <div id="playerWrapper" style="background:#000;border-radius:8px;overflow:hidden"></div>
      <div class="close"><button id="closeModalBtn" aria-label="Close video">Close</button></div>
    </div>
  </div>

  <script>
    // Filtering logic (keeps previous behaviour)
    const buttons = document.querySelectorAll('.filter-btn');
    const masonry = document.getElementById('masonry');
    const noResults = document.getElementById('noResults');

    function getCards() { return Array.from(masonry.querySelectorAll('.card')); }

    function applyFilter(filter){
      buttons.forEach(b => {
        const active = b.dataset.filter === filter;
        b.classList.toggle('active', active);
        b.setAttribute('aria-pressed', active ? 'true' : 'false');
      });

      let shown = 0;
      const cards = getCards();
      cards.forEach((card, i) => {
        const cat = card.dataset.category || '';
        if(filter === 'all' || cat === filter){
          card.style.display = 'inline-block';
          card.style.animationDelay = (i * 45) + 'ms';
          shown++;
        } else {
          card.style.display = 'none';
        }
      });
      noResults.style.display = shown ? 'none' : 'block';
    }

    buttons.forEach(btn => btn.addEventListener('click', () => applyFilter(btn.dataset.filter)));
    // keyboard support
    buttons.forEach(btn => btn.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); applyFilter(btn.dataset.filter); } }));

    // init
    applyFilter('all');

    // Video modal logic (same as before)
    const modal = document.getElementById('videoModal');
    const playerWrapper = document.getElementById('playerWrapper');
    const closeModalBtn = document.getElementById('closeModalBtn');

    function openVideo(url){
      const iframe = document.createElement('iframe');
      iframe.src = url + '?autoplay=1';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      playerWrapper.innerHTML = '';
      playerWrapper.appendChild(iframe);
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }

    function closeVideo(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); playerWrapper.innerHTML = ''; }

    document.addEventListener('click', (e) => {
      const card = e.target.closest('.card');
      if(!card) return;
      if(card.classList.contains('video') && card.dataset.video){
        openVideo(card.dataset.video);
      }
    });

    closeModalBtn.addEventListener('click', closeVideo);
    modal.addEventListener('click', (e) => { if(e.target === modal) closeVideo(); });
    document.addEventListener('keydown', (e) => { if(e.key === 'Escape' && modal.classList.contains('open')) closeVideo(); });

    // Audio recording + form submission + append to masonry
    let mediaRecorder = null;
    let audioChunks = [];
    let recordedBlob = null;

    const startBtn = document.getElementById('startRecord');
    const stopBtn = document.getElementById('stopRecord');
    const clearBtn = document.getElementById('clearAudio');
    const audioPlayback = document.getElementById('audioPlayback');

    startBtn.addEventListener('click', async () => {
      // request microphone permission and start recording
      if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){
        alert('Audio recording not supported on this browser.');
        return;
      }
      try{
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        mediaRecorder.ondataavailable = e => { if(e.data && e.data.size) audioChunks.push(e.data); };
        mediaRecorder.onstop = () => {
          recordedBlob = new Blob(audioChunks, { type: audioChunks[0]?.type || 'audio/webm' });
          const url = URL.createObjectURL(recordedBlob);
          audioPlayback.src = url;
          audioPlayback.style.display = 'block';
        };
        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
        clearBtn.disabled = true;
      } catch(err){
        console.error(err);
        alert('Could not start recording — please allow microphone access.');
      }
    });

    stopBtn.addEventListener('click', () => {
      if(mediaRecorder && mediaRecorder.state !== 'inactive'){
        mediaRecorder.stop();
        // stop tracks to free mic
        mediaRecorder.stream && mediaRecorder.stream.getTracks().forEach(t => t.stop?.());
      }
      startBtn.disabled = false;
      stopBtn.disabled = true;
      clearBtn.disabled = false;
    });

    clearBtn.addEventListener('click', () => {
      recordedBlob = null;
      audioChunks = [];
      audioPlayback.src = '';
      audioPlayback.style.display = 'none';
      clearBtn.disabled = true;
    });

    // form handling
    const form = document.getElementById('feedbackForm');
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = (document.getElementById('name').value || 'Anonymous').trim();
      const category = document.getElementById('category').value || 'Other';
      const text = document.getElementById('textFeedback').value.trim();
      if(!text){
        alert('Please write your feedback.');
        return;
      }

      // create new card element
      const newCard = document.createElement('article');
      newCard.className = 'card';
      newCard.dataset.category = category;

      // apply 'video' class only if video (not used here). For audio, we show player inside.
      const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=E0F2FE&color=333&size=96`;

      newCard.innerHTML = `
        <div class="meta">
          <img class="avatar" src="${avatarUrl}" alt="${escapeHtml(name)} avatar">
          <div>
            <div class="who">${escapeHtml(name)}</div>
            <div class="badge">${escapeHtml(category)} • Visitor</div>
          </div>
          <div class="cat">${escapeHtml(category)}</div>
        </div>
        <p>${escapeHtml(text)}</p>
        <div class="footer"><div class="badge">Submitted</div><div class="muted">${new Date().toLocaleDateString()}</div></div>
      `;

      // if recorded audio exists, append audio player and label
      if(recordedBlob){
        const audioEl = document.createElement('audio');
        audioEl.controls = true;
        audioEl.className = 'audio-embedded';
        const audioUrl = URL.createObjectURL(recordedBlob);
        audioEl.src = audioUrl;
        audioEl.style.marginTop = '8px';
        newCard.appendChild(audioEl);

        // mark card visually as having audio (small badge)
        const b = newCard.querySelector('.footer .badge');
        if(b) b.textContent = 'Audio';
      }

      // append to masonry (prepend so newest on top)
      masonry.insertBefore(newCard, masonry.firstChild);

      // re-run filter so visibility matches current filter
      const activeBtn = document.querySelector('.filter-btn.active');
      const currentFilter = activeBtn ? activeBtn.dataset.filter : 'all';
      applyFilter(currentFilter);

      // reset form UI (keep recorded audio cleared after submit)
      form.reset();
      recordedBlob = null;
      audioChunks = [];
      audioPlayback.src = '';
      audioPlayback.style.display = 'none';
      clearBtn.disabled = true;
      startBtn.disabled = false;
      stopBtn.disabled = true;

      // small success cue
      alert('Thanks! Your feedback has been added to the wall.');
    });

    // helper to escape HTML in user input
    function escapeHtml(unsafe){
      return unsafe
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // ensure animation delay for newly added cards is applied
    window.addEventListener('load', () => {
      getCards().forEach((c, i) => c.style.animationDelay = (i * 45) + 'ms');
    });

    // small utility used by applyFilter
    // (re-defined here to avoid reference error before function declared)
    function applyFilter(filter){
      buttons.forEach(b => {
        const active = b.dataset.filter === filter;
        b.classList.toggle('active', active);
        b.setAttribute('aria-pressed', active ? 'true' : 'false');
      });

      let shown = 0;
      const cards = getCards();
      cards.forEach((card, i) => {
        const cat = card.dataset.category || '';
        if(filter === 'all' || cat === filter){
          card.style.display = 'inline-block';
          card.style.animationDelay = (i * 45) + 'ms';
          shown++;
        } else {
          card.style.display = 'none';
        }
      });
      noResults.style.display = shown ? 'none' : 'block';
    }

  </script>
</body>
</html>
